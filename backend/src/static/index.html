<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Bounty Payment Backend</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 300;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #ecf0f1;
            border-radius: 10px;
            background: #fafbfc;
        }
        .section h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 500;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #34495e;
        }
        input, button {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        .success {
            background-color: #d5f4e6;
            border: 2px solid #27ae60;
            color: #1e8449;
        }
        .error {
            background-color: #fadbd8;
            border: 2px solid #e74c3c;
            color: #c0392b;
        }
        .info {
            background-color: #d6eaf8;
            border: 2px solid #3498db;
            color: #2471a3;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background-color: #27ae60; }
        .status-unhealthy { background-color: #e74c3c; }
        .network-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .network-info h3 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }
        .network-info p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Creator Bounty</h1>
        <p class="subtitle">Plasma Network Payment Backend</p>
        
        <div class="network-info">
            <h3>üîó Plasma Testnet</h3>
            <p>Chain ID: 9746 | Currency: XPL</p>
            <p>Explorer: <a href="https://testnet.plasmascan.to" target="_blank" style="color: #ffffff;">testnet.plasmascan.to</a></p>
        </div>
        
        <!-- Health Check Section -->
        <div class="section">
            <h2>üè• System Health</h2>
            <button onclick="checkHealth()">Check System Health</button>
            <div id="healthResult" class="result" style="display: none;"></div>
        </div>

        <div class="grid">
            <!-- Balance Check Section -->
            <div class="section">
                <h2>üí∞ Check Balance</h2>
                <div class="form-group">
                    <label for="tokenAddress">Token Address (optional):</label>
                    <input type="text" id="tokenAddress" placeholder="0x... (leave empty for XPL only)">
                </div>
                <button onclick="checkBalance()">Check Balance</button>
                <div id="balanceResult" class="result" style="display: none;"></div>
            </div>

            <!-- Transaction Status Section -->
            <div class="section">
                <h2>üîç Transaction Status</h2>
                <div class="form-group">
                    <label for="txHash">Transaction Hash:</label>
                    <input type="text" id="txHash" placeholder="0x...">
                </div>
                <button onclick="checkTransactionStatus()">Check Status</button>
                <div id="statusResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Native Payment Section -->
        <div class="section">
            <h2>üí∏ Send XPL Payment</h2>
            <div class="form-group">
                <label for="nativeRecipient">Recipient Address:</label>
                <input type="text" id="nativeRecipient" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="nativeAmount">Amount (XPL):</label>
                <input type="number" id="nativeAmount" step="0.000001" placeholder="0.1">
            </div>
            <button onclick="sendNativePayment()">Send XPL Payment</button>
            <div id="nativeResult" class="result" style="display: none;"></div>
        </div>

        <!-- Token Payment Section -->
        <div class="section">
            <h2>ü™ô Send ERC-20 Token</h2>
            <div class="form-group">
                <label for="tokenRecipient">Recipient Address:</label>
                <input type="text" id="tokenRecipient" placeholder="0x...">
            </div>
            <div class="form-group">
                <label for="tokenAmount">Amount:</label>
                <input type="number" id="tokenAmount" step="0.000001" placeholder="10.0">
            </div>
            <div class="form-group">
                <label for="tokenContractAddress">Token Contract Address:</label>
                <input type="text" id="tokenContractAddress" placeholder="0x... (Token contract address)">
            </div>
            <button onclick="sendTokenPayment()">Send Token Payment</button>
            <div id="tokenResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/payment';

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        function showInfo(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result info';
            element.textContent = message;
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { data, status: response.status, ok: response.ok };
            } catch (error) {
                return { error: error.message, status: 0, ok: false };
            }
        }

        async function checkHealth() {
            showInfo('healthResult', 'Checking system health...');
            
            const result = await makeRequest(`${API_BASE}/health`);
            
            if (result.error) {
                showResult('healthResult', { error: result.error }, true);
                return;
            }

            showResult('healthResult', result.data, !result.ok);
        }

        async function checkBalance() {
            const tokenAddress = document.getElementById('tokenAddress').value.trim();
            showInfo('balanceResult', 'Checking balance...');
            
            let url = `${API_BASE}/balance`;
            if (tokenAddress) {
                url += `?token_address=${encodeURIComponent(tokenAddress)}`;
            }
            
            const result = await makeRequest(url);
            
            if (result.error) {
                showResult('balanceResult', { error: result.error }, true);
                return;
            }

            showResult('balanceResult', result.data, !result.ok);
        }

        async function sendNativePayment() {
            const recipient = document.getElementById('nativeRecipient').value.trim();
            const amount = document.getElementById('nativeAmount').value.trim();
            
            if (!recipient || !amount) {
                showResult('nativeResult', { error: 'Please fill in all fields' }, true);
                return;
            }

            showInfo('nativeResult', 'Sending XPL payment...');
            
            const result = await makeRequest(`${API_BASE}/send-native`, {
                method: 'POST',
                body: JSON.stringify({ recipient, amount: parseFloat(amount) })
            });
            
            if (result.error) {
                showResult('nativeResult', { error: result.error }, true);
                return;
            }

            showResult('nativeResult', result.data, !result.ok);
            
            // Clear form on success
            if (result.ok) {
                document.getElementById('nativeRecipient').value = '';
                document.getElementById('nativeAmount').value = '';
            }
        }

        async function sendTokenPayment() {
            const recipient = document.getElementById('tokenRecipient').value.trim();
            const amount = document.getElementById('tokenAmount').value.trim();
            const tokenAddress = document.getElementById('tokenContractAddress').value.trim();
            
            if (!recipient || !amount || !tokenAddress) {
                showResult('tokenResult', { error: 'Please fill in all fields' }, true);
                return;
            }

            showInfo('tokenResult', 'Sending token payment...');
            
            const result = await makeRequest(`${API_BASE}/send-token`, {
                method: 'POST',
                body: JSON.stringify({ 
                    recipient, 
                    amount: parseFloat(amount),
                    token_address: tokenAddress
                })
            });
            
            if (result.error) {
                showResult('tokenResult', { error: result.error }, true);
                return;
            }

            showResult('tokenResult', result.data, !result.ok);
            
            // Clear form on success
            if (result.ok) {
                document.getElementById('tokenRecipient').value = '';
                document.getElementById('tokenAmount').value = '';
                document.getElementById('tokenContractAddress').value = '';
            }
        }

        async function checkTransactionStatus() {
            const txHash = document.getElementById('txHash').value.trim();
            
            if (!txHash) {
                showResult('statusResult', { error: 'Please enter a transaction hash' }, true);
                return;
            }

            showInfo('statusResult', 'Checking transaction status...');
            
            const result = await makeRequest(`${API_BASE}/transaction-status/${encodeURIComponent(txHash)}`);
            
            if (result.error) {
                showResult('statusResult', { error: result.error }, true);
                return;
            }

            showResult('statusResult', result.data, !result.ok);
        }

        // Auto-check health on page load
        window.addEventListener('load', () => {
            setTimeout(checkHealth, 500);
        });
    </script>
</body>
</html>
